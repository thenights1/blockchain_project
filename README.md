# 区块链项目文档
### 功能要求：
1. 多节点协作和网络通信： 创建多个节点，每个节点能够通过网络通信。使用合适的RPC方式确保支持以下区块链交互指令：

- 添加新交易到待处理池；

- 提交区块到共识过程；

- 获取特定交易或区块的信息；

- 执行节点之间的同步操作；

2. 数据结构和存储： 实现交易、区块和区块链的数据结构，并提供数据库或文件存储机制来持久化这些数据；

3. PBFT共识： 集成PBFT作为共识机制，实现PBFT算法中的预准备、准备、提交等步骤，可以处理拜占庭错误；

4. 轮换主节点： 提供主节点轮换机制；

5. 交易验证： 实现ECDSA签名验证，以确保交易的真实性和完整性。

6. 你认为有意思的区块链功能：任选1项未指明的内容（不包括BloomFilter）
### 开发要求：
使用Golang编程语言，利用其并发编程特性来构建多节点区块链系统；

确保系统具备足够的并发能力，以支持高效的区块链交互和PBFT共识算法；

可以合理使用第三方库来加速开发，提高系统的稳定性和性能；

允许使用AI工具，但需理解代码设计，并在项目报告中说明；

----------------------------------------------------------------------------------

## 项目设计主体思想
1. 区块链是一个由区块组成的链，需要先创建一个创世区块，然后之后的区块保存前一个区块的哈希值来确保连成一条链。
2. 区块用结构体来保存，里面应包含的数据有：区块序号、前一个区块的哈希值、所存储的交易池、创建时的时间戳，便于顺序增加区块链的长度
3. 结点是接收交易的主体，也需要用结构体来保存数据，其中应包含的数据有：
   - 结点id，用来唯一标记结点
   - 待处理池，应当是一个以交易结构体为元素的数组
   - 公钥与私钥，用来进行消息验证
   - 共识机制，pbft的结构体，利用其来调用一些共识机制里面的函数
   - 一条区块链，也就是主链，所有的结点共同拥有
   - 互斥锁，用来保证并发过程的安全
   - 同步标志，来标记是否已经被同步过
4. 交易也应用结构体来保存，里面包含的数据有：
   - 发送地址与接收地址，由main函数模拟，拟先设置一个地址池，存放若干个地址，暂定数组大小为100
   - 交易id
   - 交易金额
   - 手续费
   - 时间戳
   - 数字签名
6. 用户发起交易这一过程拟用main函数来进行模拟。
7. 确定打包的交易数量机制：由于结点每次提交区块内包含的交易数量不能过多，否则会影响性能，因此如何平衡好交易数量与区块大小，本项目拟用以下几点原则：
   - 一旦结点待处理池内包含有十个交易，且手续费未大于5 Dan，则将十个交易打包成区块提交，即区块最多限制拥有十条交易
   - 待处理池内的交易按手续费大小排序，越大的排序越靠前
   - 如果处理池内前n个交易的手续费之和大于5 Dan，则直接打包发送，即鼓励多交手续费（n<10）
8. 如何确定区块的有效性，采用如下方法：
   - 消息签名验证： 节点首先会验证预准备消息的数字签名，确保该消息确实是由提出者签名的。这可以通过提出者的公钥进行验证。采取ecdsa
   - 消息顺序验证： PBFT 共识要求消息的顺序是严格的，即每个节点在相同的视图中只能收到一条预准备消息。
   - 一致性验证： 节点会检查是否已经收到了足够数量的相同的预准备消息，以确保至少超过两-thirds的节点都同意该区块。
9. 如何验证交易的有效性，本项目采用如下几点：
    - 数字签名验证： 交易通常由发送者使用私钥进行签名，接收者使用对应的公钥进行验证。这样可以确保交易确实是由发送者创建的，并且在传输过程中没有被篡改
    - 交易内容验证： 发送者和接收者地址的有效性、交易金额是否为正数。
    - 余额检查： 在区块链系统中，通常会维护每个地址的余额。在处理交易时，需要检查发送者的余额是否足够支付交易金额，以及更新余额信息。这确保了交易不会导致负余额或其他不一致的情况
    - 双重支付检测： 防止同一笔资金被多次使用，即双重支付。通过检查交易是否已经被包含在之前的区块中，或者维护一个已经花费的交易列表，可以防止双重支付问题。

## 关于PBFT
PBFT（Practical Byzantine Fault Tolerance）是一种拜占庭容错共识算法，旨在解决分布式系统中存在恶意节点或节点失效的问题。以下是PBFT的主要过程：
- 视图切换： PBFT中引入了“视图（view）”的概念。系统的运行被划分为一系列视图，每个视图有一个主节点（primary）。节点按照一定的轮换机制充当主节点，轮流提出新的区块。
- 请求预准备（Pre-Prepare）： 当一个节点（主节点）收到客户端的请求时，它首先会在当前视图中提出一个预准备消息，包含了提出的区块和一些其他信息。其他节点收到预准备消息后，验证提出的区块的合法性，并在达成共识的情况下向其他节点广播准备消息。
- 准备（Prepare）： 节点在接收到足够数量的预准备消息后，会向其他节点广播准备消息，表明它已经对提出的区块进行了验证。其他节点在接收到足够数量的准备消息后，也会广播准备消息。
- 提交（Commit）： 当一个节点收到足够数量的准备消息后，它可以向其他节点广播提交消息，表示它已经对提出的区块达成了共识。其他节点在接收到足够数量的提交消息后，也会提交该区块。
- 视图切换和重试： 如果节点在某个视图中无法达成共识，系统将进行视图切换，选择下一个主节点，并重新开始共识过程。这有助于应对主节点的故障或恶意行为。
- 状态机执行： 一旦一个区块被提交，每个节点都会将该区块中的交易应用于其本地状态机，从而确保所有节点都具有相同的状态。
